function AjaxRequest(n,t){t=t||Verb.Get,this.__Abort=!1,this.XMLHttpRequest=null,this.Url=n,this.Parameters=new Dictionary,this.ResponseWrappedProperty=AjaxRequest.DefaultResponseWrappedProperty,this.RequestBodyType=DataEncodingType.JSON,this.ResponseBodyType=DataEncodingType.JSON,this.OnAbort=new Event(this),this.OnError=new Event(this),this.OnSend=new Event(this),this.OnSuccess=new Event(this),this.OnTimeOut=new Event(this),this.Data=null,this.PreventCacheCalls=AjaxRequest.PreventCacheCalls,this.Type=Type.AjaxRequest,this.Tag=null,this.TimeOut=AjaxRequest.DefaultTimeOut,this.Synchronous=!1,this.Verb=t,this.AdditionalHeaders=new Dictionary,this.__TimeOutObject=null}function ServiceReference(n,t){this.Service=n,this.UrlFormat=t||WebServiceRequest.ServiceUrlFormat,this.AdditionalHeaders=new Dictionary}function ServiceCall(n,t,i,r,u,f){this.Parameters=f,this.Sync=u,this.ServiceRequest=new AjaxRequest(i,t),this.ServiceReference=n;var e=function(){var n=arguments.callee.Service,t=Array.From(arguments),e=n.Parameters,o=n.ServiceRequest.Parameters,f=t.length,r=t[f-2],i=t[f-1],u;if(n.ServiceRequest.OnSuccess.Clear(),n.ServiceRequest.OnError.Clear(),n.ServiceRequest.Abort(),(r||i)&&(r&&(r.Type===Type.Function||r.Type===Type.Delegate)?(n.ServiceRequest.OnSuccess.Add(r),n.ServiceRequest.OnError.Add(i),n.ServiceRequest.OnTimeOut.Add(i),t.pop(),t.pop()):(i.Type===Type.Function||i.Type===Type.Delegate)&&(n.Sync?(n.ServiceRequest.OnError.Add(i),n.ServiceRequest.OnTimeOut.Add(i)):n.ServiceRequest.OnSuccess.Add(i),t.pop())),t.length>0&&t[0].Type===Type.Dictionary)n.ServiceRequest.Parameters=t[0];else if(n.Parameters.length==0&&t.length==1)n.ServiceRequest.Data=t[0];else for(f=t.length,u=0;u<f;u++)o[e[u]]=t[u];return(n.ServiceRequest.AdditionalHeaders=n.ServiceReference.AdditionalHeaders,n.Sync)?n.ServiceRequest.Send(n.Sync).ResponseObject:(n.ServiceRequest.Send(),n.ServiceRequest)};return e.Service=this,e}function AjaxEventArgs(n){this.CancelEvent=!1,this.Type=Type.AjaxEventArgs,this.Request=n,this.ResponseCode=0,this.ResponseText=undefined,this.ResponseObject=undefined}var $AjaxRequest=$WebServiceRequest=$AjaxEventArgs=$Array,NinJaAjax={Version:"1.1",CurrentCalls:[],QueuedCalls:[],NoMoreCalls:!1},Verb={Get:"GET",Post:"POST",FormPost:"~POST",Delete:"DELETE"},DataEncodingType,PostOptions,WebServiceRequest;Type.Request="AjaxRequest",Type.AjaxEventArgs="AjaxEventArgs",Type.WebServiceRequest="WebServiceRequest",DataEncodingType={None:0,Raw:1,UrlEncoded:2,JSON:3,Form:4},PostOptions={None:0,IncludeASPEventFields:1,IncludeASPViewState:2},Page.OnLoad.Add(function(){Page.OnClose.Add(function(){for(var t=NinJaAjax.CurrentCalls,i=t.length,n=0;n<i;n++)t[n].Abort();return NinJaAjax.NoMoreCalls=!0,undefined})}),NinJaAjax.CreateHttpObject=function(){xmlHttp=null;try{xmlHttp=new XMLHttpRequest}catch(n){try{xmlHttp=new ActiveXObject("Msxml2.XMLHTTP")}catch(n){xmlHttp=new ActiveXObject("Microsoft.XMLHTTP")}}return xmlHttp},NinJaAjax.JSONEncode=function(n){var t={};return n.ForEach(function(n){t[n.Key]=n.Value===""?"":n.Value}),JSON.stringify(t)},NinJaAjax.UrlEncode=function(n){var t="",i=!0;return n.ForEach(function(n){NullOrUndefined(n.Value)||(i?(t+=n.Key.Encode()+"="+n.Value.toString().Encode(),i=!1):t+="&"+n.Key.Encode()+"="+n.Value.toString().Encode())}),t},NinJaAjax.HandleResponse=function(n,t,i){var u=t,r,f;if(u.__Abort!==!0&&n.readyState===4&&n.status>0){if(u.__TimeOutObject&&u.__TimeOutObject.Stop(),r=new AjaxEventArgs(u),r.ResponseText=n.responseText,n.status===200)switch(u.ResponseBodyType){case DataEncodingType.Raw:r.ResponseObject=r.ResponseText;break;case DataEncodingType.None:r.ResponseObject=undefined;break;case DataEncodingType.JSON:if(n.responseText)try{r.ResponseObject=n.responseText.ToObjectFromJSON()}catch(e){u.OnError.length>0?u.OnError.Fire(r):NinJaAjax.DefaultOnError(r)}else r.ResponseObject=undefined;r.ResponseObject!==null&&u.ResponseWrappedProperty!==null&&(r.ResponseObject=r.ResponseObject[u.ResponseWrappedProperty])}return r.ResponseCode=n.status,n.status!==200?u.OnError.length>0?u.OnError.Fire(r):NinJaAjax.DefaultOnError(r):i||u.OnSuccess.Fire(r),NinJaAjax.CurrentCalls.Remove(t),NinJaAjax.QueuedCalls.length>0&&(f=NinJaAjax.QueuedCalls[0],NinJaAjax.QueuedCalls.RemoveAt(0),f.Send()),r}},NinJaAjax.HandleError=function(n){confirm("An error has occurred during your web request. Would you like to see detailed information?")&&alert(n.ResponseText)},NinJaAjax.HandleTimeOut=function(){},NinJaAjax.DefaultOnError=NinJaAjax.HandleError,NinJaAjax.DefaultOnTimeOut=NinJaAjax.HandleTimeOut,AjaxRequest.prototype.Send=function(n){var e,t,u,o,i,r,f;if(n=n||!1,!NinJaAjax.NoMoreCalls){if(!n){if(NinJaAjax.CurrentCalls.length>5){NinJaAjax.QueuedCalls.Add(this);return}NinJaAjax.CurrentCalls.Add(this)}for(this.__Abort=!1,this.XMLHttpRequest=NinJaAjax.CreateHttpObject(),e=this,AjaxRequest.DefaultParameters.ForEach(function(n){e.Parameters.Add(n.Key,n.Value)}),t=this.Url||Page.Href(),this.Verb===Verb.Get&&(t.Contains("?")||(t+="?"),t+=NinJaAjax.UrlEncode(this.Parameters)),this.PreventCacheCalls===!0&&(t.Contains("?")||(t+="?"),t+="&rgk="+DateTime.Now().Ticks()),n||(this.XMLHttpRequest.onreadystatechange=new Delegate(NinJaAjax.HandleResponse,null,[this.XMLHttpRequest,this])),this.XMLHttpRequest.open(this.Verb.Replace("~",""),t,!n),NinJaAjax.SendCookies&&document.cookie.length>0&&this.XMLHttpRequest.setRequestHeader("Cookie",document.cookie),this.XMLHttpRequest.setRequestHeader("X-Requested-With","XMLHttpRequest"),u=this.AdditionalHeaders.Keys(),o=u.length,i=0;i<o;i++)this.XMLHttpRequest.setRequestHeader(u[i],this.AdditionalHeaders[u[i]]);switch(this.RequestBodyType){case DataEncodingType.JSON:r=this.Parameters.Count()==0?NullOrUndefined(this.Data)?"":JSON.stringify(this.Data):NinJaAjax.JSONEncode(this.Parameters),f="application/json; charset=utf-8";break;case DataEncodingType.Raw:r=this.Data;break;case DataEncodingType.Form:r=NinJaAjax.UrlEncode(this.Parameters),f="application/x-www-form-urlencoded; charset=utf-8"}switch(this.Verb){case Verb.Post:this.XMLHttpRequest.setRequestHeader("Content-Type",f),this.XMLHttpRequest.send(r);break;case Verb.Get:this.XMLHttpRequest.send();break;case Verb.FormPost:this.XMLHttpRequest.setRequestHeader("Content-Type",f),this.XMLHttpRequest.send(r)}if(n)return NinJaAjax.HandleResponse(this.XMLHttpRequest,this,!0);this.__TimeOutObject=Timer.Delay(this.TimeOut,new Delegate(this.__TimeOut,this)),this.OnSend.Fire()}},AjaxRequest.prototype.Post=function(n){n=n||PostOptions.None;for(var r=Page.DOM.querySelectorAll("input, select, textarea"),u=r.length,t,i=0;i<u;i++){t=r[i].$;switch(t.DOM.type.toLowerCase()||t.DOM.tagName.toLowerCase()){case"text":case"textarea":this.Parameters.Add(t.Name(),t.Text());break;case"checkbox":t.Checked()&&this.Parameters.Add(t.Name(),"on");break;case"radio":if(!t.Checked())continue;case"hidden":case"password":case"select-one":this.Parameters.Add(t.Name(),t.Value())}}this.RequestBodyType=DataEncodingType.Form,this.Verb=Verb.FormPost,this.PreventCacheCalls=!1,this.Send()},AjaxRequest.DefaultResponseWrappedProperty="d",AjaxRequest.DefaultParameters=new Dictionary,AjaxRequest.SendCookies=!1,AjaxRequest.DefaultTimeOut=new TimeSpan(0,1),AjaxRequest.PreventCacheCalls=!0,WebServiceRequest={ServiceUrlFormat:"{Service}/{Function}"},WebServiceRequest.GenerateServiceReference=function(n,t){window[n]===undefined&&(window[n]=new ServiceReference(n,t))},ServiceReference.prototype.AddCall=function(n,t){var i=Array.From(arguments),r=String.BindFormat(this.UrlFormat,{Service:this.Service,Function:t});i.RemoveAt(0).RemoveAt(0).RemoveAt(0),this[t+"Async"]=new ServiceCall(this,n,r,t,!1,i),this[t]=new ServiceCall(this,n,r,t,!0,i)},AjaxRequest.prototype.Abort=function(){if(this.__Abort=!0,this.XMLHttpRequest){try{this.XMLHttpRequest.abort&&this.XMLHttpRequest.abort()}catch(n){}delete this.XMLHttpRequest,this.__TimeOutObject&&this.__TimeOutObject.Stop()}this.OnAbort.length>0&&this.OnAbort.Fire(new AjaxEventArgs(this))},AjaxRequest.prototype.__TimeOut=function(){if(this.XMLHttpRequest!==null){try{this.XMLHttpRequest.abort()}catch(n){}delete this.XMLRequestRequest}this.OnTimeOut.length>0?this.OnTimeOut.Fire(new AjaxEventArgs(this)):NinJaAjax.DefaultOnTimeOut(new AjaxEventArgs(this))};
//# sourceMappingURL=NinJaAjax.min.js.map