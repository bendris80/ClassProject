function GridView(n){var t,r,u,i,f,e,s,o;if(this.DOM===undefined)return GridView.Inherit(GridView.Extend(new Table(n).ClassName("gridview")));for(t=this,n=t.DOM,t.__dp=(n.getAttribute("display")||"10").ToInt(),t.Columns=new ObservableArray(t),t.Columns.$$=!0,r=t.Head.Rows[0].Cells,e=n.getElementsByTagName("col"),o={},f=e.length,i=0;i<f;i++)o[(e[i].getAttribute("index")||i).toString()]=e[i];for(f=r.length,i=0;i<f;i++)u=r[i],t.Columns.Add(GridViewColumn.Inherit(GridViewColumn.Extend(u),o[i.toString()])),u.Parent=this;if(t.Columns.OnChange.Add(new Delegate(t.ColumnsUpdate,t,[Delegate.Event])),t.__Selectable=(n.getAttribute("selectable")||"false").ToBoolean(),t.__Focus=(new Anchor).Position("fixed").X(-100).Y(10).Text("rawr").Href("javascript: Null()"),t.__Multiple=(n.getAttribute("multiple")||"false").ToBoolean(),t.__MultiMode=n.getAttribute("multimode")||"toggle",t.__Sortable=(n.getAttribute("sortable")||"true").ToBoolean(),t.__SelectClass=n.getAttribute("selectclass")||"selected",t.__SortClass=n.getAttribute("sortclass")||"sorted",t.__ASortClass=n.getAttribute("ascsortclass")||"",t.__DSortClass=n.getAttribute("descsortclass")||"",t.__RowHeight=n.getAttribute("rowheight")||GridView.DefaultRowHeight,t.__Loading=!1,Page.AddElement(t.__Focus),t.__LastIndex=-1,t.__LastClick=-1,t.__FirstRow=-1,t.__LastRow=-1,n.setAttribute("refreshrequired","1"),t.OnClick.Add(new Delegate(t.__Focus.Focus,t.__Focus)),t.Style(Style.TableLayout,"fixed").NaturalDisplay="inline-block",t.Data=new ObservableArray(t),t.SelectedData=new ObservableArray(t),t.Container=(new Div).Width(t.AttributeWidth()).ClassName("gridviewcontainer"),t.Container.Style(Style.WhiteSpace,"nowrap"),n.parentNode.replaceChild(t.Container.DOM,n),t.ScrollBar=new ScrollBar,t.ScrollBar.Style(Style.Float,"right"),t.Holder=(new Div).Style(Style.Display,"inline-block"),t.Holder.AddElement(t),t.Container.AddElements([t.ScrollBar,t]),t.Style(Style.BorderCollapse,"separate"),t.AscSortIcon=GridView.AscSortIcon,t.DescSortIcon=GridView.DescSortIcon,t.SortIcon=(new Span).Style(Style.Float,"right"),t.OnSelectionChanged=t.SelectedData.OnChange,t.OnRowBound=new Event(t),t.MessageRow=new Row,t.MessageRow.Cells.Add(new Cell),t.__Focus.OnKeyDown.Add(new Delegate(t.HandleKey,t,[Delegate.Event])),t.ScrollBar.OnScrollChange.Add(new Delegate(t.Refresh,t)),t.OnMouseWheel.Add(new Delegate(t.HandleScroll,t,[Delegate.Event])),t.__M=!1,(Client.Browser.Type===BrowserType.iPad||Client.Browser.Type===BrowserType.Android)&&(t.Body.OnTouchStart.Add(new Delegate(t._mobCapture,t,[Delegate.Event])),t.Body.OnTouchEnd.Add(new Delegate(t._mobRelease,t)),t.Body.OnTouchMove.Add(new Delegate(t._mobSwipe,t,[Delegate.Event])),t.__M=!0),u=t.Container.Style(Style.Width),u.Type===Type.String&&u.Contains("%")&&Client.OnResize.Add(new Delegate(t.RefreshDisplay,t)),t.RefreshRows(),t.Data.OnChange.Add(new Delegate(t.RefreshData,t)),t.RefreshData(),t.SelectedData.OnChange.Add(new Delegate(t.Refresh,t)),t.__Selectable&&(t.Container.onselectstart!==undefined?t.Container.onselectstart=function(){return!1}:t.Container.OnMouseDown.Add(function(n){n.Handled=!0,n.CancelEvent=!0})),t.__Sortable)for(t.__Order=SortOrder.Ascending,r=t.Columns,f=r.length,s=new Delegate(t.Sort,t,[Delegate.Event]),i=0;i<f;i++)r[i].__Sort&&r[i].OnClick.Add(s);return t.__Sort=null,t.Type=Type.GridView,Client.Storage.Local&&(i=Client.Storage.Local.GetItem(Page.Href().pathname+":"+this.DOM.id),i&&this.Sort(i.s,i.o)),n}function GridViewColumn(n){var t,r,i,u;if(this.DOM===undefined)return GridViewColumn.Inherit(GridViewColumn.Extend((new Header).Attribute("type","check")));t=this,i=t.DOM,t.Style(Style.Overflow,"hidden").Style(Style.WhiteSpace,"nowrap").Position("relative"),n?(t.__HAlign=n.getAttribute("align")||"left",t.__VAlign=n.getAttribute("valign")||"top",t.__Style=n.getAttribute("style")||"",t.__cs=n.getAttribute("class")||""):(t.__HAlign="left",t.__VAlign="top",t.__Style="",t.__cs=""),t.__Target=i.getAttribute("target")||"",t.__Type=i.getAttribute("type")||"text",t.__HTML=(i.getAttribute("html")||"true").ToBoolean(),t.__Sort=(i.getAttribute("sortable")||"true").ToBoolean(),t.__Width=new DynamicSize(i.getAttribute("width")||"*"),t.__dp=i.getAttribute("display")||"",t.__Data=i.getAttribute("data")||"",t.__sb=i.getAttribute("sortby")||t.__Data,t.OnItemClick=(new Event).AddRange(t.OnClick),t.OnClick.Clear(),t.__Type==GridViewColumnType.Select&&(r=new CheckBox,r.OnClick.Add(new Delegate(t.SelectAllClicked,t)),t.AddElement(r),t.__C=r),t.__Type===GridViewColumnType.PopUp&&(t.__Ex=(t.DOM.getAttribute("extra")||"500,500").Split(",")),!t.__dp&&t.__Data.length>0&&(t.__dp="{"+t.__Data+"}"),t.OnColumnBound=new Event(t),u=i.getAttribute("onbound"),u&&t.OnColumnBound.Add(window[u]),t.Type=Type.GridViewColumn}function GridViewRow(){return GridViewRow.Extend(new Row)}function RowBoundEventArgs(n,t,i){this.Sender=n,this.Row=t,this.Item=i,this.Cancel=!1}function ColumnBoundEventArgs(n,t,i){this.Sender=n,this.Column=t,this.Item=i,this.Cancel=!1}var $GridView,$RowBoundEventArgs,GridViewColumnType;Type.GridView=Type.$++,Type.GridView=Type.$++,Type.GridViewColumn=Type.$++,Type.GridViewRow=Type.$++,Type.GridViewGroupRow=Type.$++,Type.DynamicSize=Type.$++,GridView.AscSortIcon="▲",GridView.DescSortIcon="▼",GridView.DefaultRowHeight="",Table.Extensions.Add(new Extension("gridview",GridView)),$GridView=$Anchor,$RowBoundEventArgs=$Array,GridView.prototype._mobCapture=function(n){this.__swipe=!0,this.__yRef=n.TouchStates[0].Y,this.__sRef=this.ScrollBar.Value()},GridView.prototype._mobSwipe=function(n){n.TouchStates.length>1||(n.Handled=!0,this.__swipe===!0&&this.ScrollBar.Value(this.__sRef+parseInt((this.__yRef-n.TouchStates[0].Y)/this.__RowHeight,10)))},GridView.prototype._mobRelease=function(){this.__swipe=!1},GridView.prototype.ColumnsUpdate=function(n){var t,i=n.Objects,r=i.length;switch(n.ModificationType){case ModificationType.Add:for(t=0;t<r;t++)this.Head.Rows[0].Cells.Insert(n.Index+t,i[t]);break;case ModificationType.Remove:case ModificationType.Clear:for(t=0;t<r;t++)this.Head.Rows[0].Cells.Remove(i[t])}this.RefreshRows(),this.RefreshData()},GridView.prototype.Sort=function(n,t){var r,i,u=this.SortIcon.DOM.parentNode,e,s,o,f;if(n===undefined){this.Data.Sort(this.__Sort,this.__Order);return}if(u!==null&&u.$!==undefined&&this.SortIcon.Parent().ClassName(""),n.Sender?(r=n.Sender,i=r.__Data,r.__sb.length>0&&(i=r.__sb)):i=n,!i){this.__Order=SortOrder.Ascending,this.__Sort=null,u!==null&&u.$!==undefined&&u.$.RemoveElement(this.SortIcon).ClassName("");return}if(i===this.__Sort)this.__Order=this.__Order===SortOrder.Ascending?SortOrder.Descending:SortOrder.Ascending;else if(this.__Order=t||SortOrder.Ascending,r!==undefined)r.InsertElement(0,this.SortIcon);else for(e=this.Columns,s=e.length,f=0;f<s;f++)if(o=e[f],o.__sb===i){o.InsertElement(0,this.SortIcon);break}return this.SortIcon.Parent()!==null&&this.SortIcon.Parent().ClassName(this.__SortClass),this.SortIcon.Text(this.__Order===SortOrder.Ascending?this.AscSortIcon:this.DescSortIcon),this.__Sort=i,this.Data.Sort(i,this.__Order),this.Refresh(),Client.Storage.Local&&Client.Storage.Local.SetItem(Page.Href().pathname+":"+this.DOM.id,{s:this.__Sort,o:this.__Order}),this},GridView.prototype.Bind=function(n){var t=this.ScrollBar.Value();this.Data.BeginUpdate(),this.Data.Clear(),n&&this.Data.AddRange(n),this.Data.length===0&&this.MessageRow.Cells[0].Text("No items"),this.__LastIndex=-1,this.__LastRow=null,this.Data.EndUpdate(),this.__Loading=!0,this.ScrollBar.Value(t),this.SelectedData.Clear(),this.__Loading=!1,this.Refresh(),this.RefreshDisplay()},GridView.prototype.Loading=function(n){return this.Data.Clear(),n=n||"Loading...",this.__Loading=!0,this.MessageRow.Cells[0].Text(n),this},GridView.prototype.Refresh=function(){var r;if(!this.__Loading){var f=this.Rows,o=f.length,t,i,n,e,u,s=this.ScrollBar.Value();for(this.__LastRow=-1,this.__FirstRow=-1,r=document.createElement("TBODY"),this.Body.DOM.parentNode.replaceChild(r,this.Body.DOM),n=1,j=s;n<o;n++,j++)t=this.Data[j],i=f[n],u=this.SelectedData.Contains(t),e=u?this.__SelectClass:"",i.Bind(t).ClassName(e),this.OnRowBound.length>0&&this.OnRowBound.Fire(new RowBoundEventArgs(this,i,t)),u&&(this.__FirstRow===-1&&(this.__FirstRow=n),this.__LastRow=n),i.Index=j;return this.Data.length>0?(this.Rows[0].Collapsed(!0),this.Rows[1].Collapsed(!1)):(this.Rows[0].Collapsed(!1).Cells[0].Text("No items.").ColumnSpan(this.Columns.length),this.Rows[1].Collapsed(!0)),r.parentNode.replaceChild(this.Body.DOM,r),this}},GridView.prototype.RefreshData=function(){this.__Sort&&this.Sort();for(var t,r=this.Columns,u=r.length,i=this.Data,f=i.length,n=0;n<f;n++)for(i[n].__P=[],t=0;t<u;t++)i[n].__P[t]=r[t].__Premutate(i[n]);this.Data.length<=this.__dp?(this.ScrollBar.Collapsed(!0),this.ScrollBar.MaxValue(0)):(this.ScrollBar.Collapsed(!1),this.ScrollBar.MaxValue(this.Data.length-this.__dp)),this.Refresh(),this.RefreshDisplay()},GridView.prototype.ScrollToItem=function(n){if(n){var t=this.Data.IndexOf(n),i=this.ScrollBar.Value(),r=this.__dp,u=r+i;if(t>=i&&t<u)return;t>=u?this.ScrollBar.Value(t-r+1):t<i&&this.ScrollBar.Value(t)}},GridView.prototype.RowHeight=function(n){if(n===undefined)return this.__RowHeight;this.__RowHeight=n,this.RefreshRows(),this.Refresh()},GridView.prototype.DisplayRows=function(n){return n===undefined?this.__dp:(this.__dp!==n&&(this.__dp=n,this.RefreshRows(),this.RefreshData(),this.ScrollBar.Collapsed(!1),this.ScrollBar.Height(this.LayoutHeight()).__RefreshView(),this.ScrollBar.MaxValue(this.Data.length-this.__dp),this.RefreshDisplay()),this)},GridView.prototype.RefreshRows=function(){this.Rows.BeginUpdate(),this.Rows.Clear();var t,i=[],n,u=this.__dp,r=new Delegate(this.HandleClick,this,[Delegate.Event]);for(i.Add(this.MessageRow.Collapsed(!0)),this.MessageRow.Cells[0].AttributeHeight(this.__RowHeight),t=0;t<u;t++)n=new GridViewRow,n.Parent=this,n.__M=this.__M,n.RefreshColumns(this.Columns),n.Bind(null),this.__Selectable&&(n.OnClick.Add(r),n.OnContextMenu.Add(r)),this.__RowHeight&&n.Cells[0].AttributeHeight(this.__RowHeight),i.Add(n);this.Rows.AddRange(i),this.Rows.EndUpdate()},GridView.prototype.HandleClick=function(n){var t=n.Sender.Tag,r,i=this.Data.IndexOf(t);r=i,NullOrUndefined(t)||(this.SelectedData.BeginUpdate(),this.__MultiMode=="toggle"?Keyboard.ShiftKey?(this.SelectedData.Clear().AddRange(this.Data.Subset(this.__LastIndex,i)),i=this.__LastIndex):this.SelectedData.Contains(t)?this.SelectedData.Remove(t):this.SelectedData.Add(t):this.SelectedData.Contains(t)||(this.SelectedData.Clear(),this.SelectedData.Add(t)),this.__LastIndex=i,this.__LastClick=r,this.SelectedData.EndUpdate())},GridView.prototype.HandleScroll=function(n){this.ScrollBar.Collapsed()||(this.ScrollBar.Value(this.ScrollBar.Value()+n.Clicks),n.Handled=!0)},GridView.prototype.HandleKey=function(n){var t=this.__LastIndex,i=this.Data,r=this.SelectedData,u=!1;if(i.length!==0){n.Handled=!0;switch(n.Key){case Keys.A:Keyboard.ControlKey&&(r.BeginUpdate(),r.length!==i.length?r.Clear().AddRange(i):r.Clear(),r.EndUpdate());break;case Keys.DownArrow:t++,t>=i.length&&(t=i.length-1),this.__LastIndex!==t&&(u=!0,this.__LastRow===this.__dp&&this.ScrollBar.Value(this.ScrollBar.Value()+1));break;case Keys.UpArrow:u=!0,t--,t<0&&(t=0),this.__LastIndex!==t&&(u=!0,this.__FirstRow===1&&this.ScrollBar.Value(this.ScrollBar.Value()-1));break;case Keys.Home:t=0,this.ScrollBar.Value(0),u=!0;break;case Keys.End:u=!0,t=i.length-1,this.ScrollBar.Value(t);break;case Keys.PageUp:u=!0,t=t-10,t<0&&(t=0),this.ScrollBar.Value(this.ScrollBar.Value()-this.__dp);break;case Keys.PageDown:u=!0,t=t+10,t>=i.length&&(t=i.length-1),this.ScrollBar.Value(this.ScrollBar.Value()+this.__dp)}u===!0&&(r.BeginUpdate(),Keyboard.ShiftKey?r.Clear().AddRange(i.Subset(this.__LastClick,t)):(r.Clear(),r.Add(i[t]),this.__LastClick=t),r.EndUpdate()),this.__LastIndex=t}},GridView.prototype.RefreshDisplay=function(){var s,e,u,f,i,n,o,t,h,r;if(this.Displayed()){for(this.ScrollBar.Height(this.LayoutHeight()).__RefreshView(),s=this.Columns,e=s.length,o=document.createElement("THEAD"),this.AttributeWidth(0),h=this.Container.Width()-this.ScrollBar.LayoutWidth(),t=h,this.AttributeWidth(t),this.Head.DOM.parentNode.replaceChild(o,this.Head.DOM),r=[],n=0;n<e;n++){f=this.Columns[n],u=f.__Width;switch(u.DynamicSizeType){case DynamicSizeType.Static:f.Width(u.Value),t-=u.Value;break;case DynamicSizeType.Relative:i=t*u.Value,f.Width(i),t-=i;break;case DynamicSizeType.Liquid:r.Add(f)}}for(e=r.length,i=(t/r.length).Round(),n=0;n<e;n++)r[n].Width(i),t-=i;return t<0&&r[n-1].Width(i+t),o.parentNode.replaceChild(this.Head.DOM,o),this}},GridViewColumn.prototype.SelectAllClicked=function(){this.__C.Checked()?this.Parent.SelectedData.BeginUpdate().Clear().AddRange(this.Parent.Data).EndUpdate():this.Parent.SelectedData.Clear()},GridViewColumn.prototype.__Premutate=function(n){switch(this.__Type){case GridViewColumnType.Link:case GridViewColumnType.PopUp:return{__T:String.BindFormat(this.__dp,n),__D:String.BindFormat(this.__Data,n)};case GridViewColumnType.Function:return{__T:String.BindFormat(this.__dp,n)};case GridViewColumnType.Custom:return{__T:window[this.__dp](n),__D:window[this.__Data](n)};default:return{__T:String.BindFormat(this.__dp,n),__D:NinJa.EvalBind(this.__Data,n)||""}}},GridViewRow.prototype.ToggleItemSelect=function(){this.Parent.SelectedData.BeginUpdate(),this.__C.Checked()?(this.Parent.__Multiple!==!0&&this.Parent.SelectedData.Clear(),this.Parent.SelectedData.Add(this.Tag)):this.Parent.SelectedData.Remove(this.Tag),this.Parent.SelectedData.EndUpdate()},GridViewRow.prototype.Bind=function(n){this.Tag=n,this.Index=0;for(var o=this.Cells,s=o.length,t,r,e,i,f=new ColumnBoundEventArgs,u=0;u<s;u++)if(t=o[u],r=t.__Col,f.Cancel=!1,r.OnColumnBound.length>0&&(f.Column=r,f.Item=n,f.Sender=t,r.OnColumnBound.Fire(f)),!n||f.Cancel)switch(r.__Type){case GridViewColumnType.Select:t.__C.Collapsed(!0);break;case GridViewColumnType.Custom:case GridViewColumnType.Text:t.Content("&nbsp;");break;case GridViewColumnType.PopUp:case GridViewColumnType.Function:case GridViewColumnType.Link:t.__A.Collapsed(!0);break;case GridViewColumnType.Image:t.__I.Collapsed(!0)}else{i=n.__P[u].__T,e=n.__P[u].__D;switch(r.__Type){case GridViewColumnType.Select:t.__C.OnCheckChanged.Enabled(!1),t.__C.Collapsed(!1).Checked(this.Parent.SelectedData.Contains(this.Tag)),t.__C.OnCheckChanged.Enabled(!0);break;case GridViewColumnType.Text:NullOrUndefined(i)?t.Text("  "):r.__HTML?t.Content(i):t.Text(i);break;case GridViewColumnType.Function:t.__A.Text(i).Collapsed(!1),t.__D.Parameters[0]=n;break;case GridViewColumnType.PopUp:this.__M?t.__A.Text(i).Collapsed(!1).Href(e):t.__A.Text(i).Collapsed(!1).OnClick[0].Parameters[0]=e;break;case GridViewColumnType.Link:t.__A.Text(i).Href(e).Collapsed(!1).Target(r.__Target);break;case GridViewColumnType.Image:i?t.__I.Source(i).Collapsed(!1):t.__I.Collapsed(!0)}}return this},GridViewRow.prototype.HandleColumnClick=function(n){n.OnItemClick.Fire(new EventArgs(this,this.Tag))},GridViewRow.prototype.RefreshColumns=function(n){this.Cells.BeginUpdate(),this.Cells.Clear();for(var f=n,o=f.length,r,e=[],i,t,u=0;u<o;u++){r=f[u],i=(new Cell).ClassName(r.__cs).HorizontalAlignment(r.__HAlign).VerticalAlignment(r.__VAlign),i.OnClick.Add(new Delegate(this.HandleColumnClick,this,[r])),i.DOM.setAttribute("style",r.__Style),i.Style(Style.Overflow,"hidden").Style(Style.WhiteSpace,"nowrap"),i.__Col=r;switch(r.__Type){case GridViewColumnType.Select:t=new CheckBox,t.OnCheckChanged.Add(new Delegate(this.ToggleItemSelect,this)),i.AddElement(t),i.__C=this.__C=t;break;case GridViewColumnType.Function:t=new Anchor,i.__A=t,i.AddElement(t),i.__D=new Delegate(window[r.__Data]),t.OnClick.Add(i.__D);break;case GridViewColumnType.PopUp:t=new Anchor,i.__A=t,i.AddElement(t),this.__M===!0?t.Target("__blank"):t.OnClick.Add(new Delegate(SafePopUp,null,["",r.__Ex[0],r.__Ex[1]]));break;case GridViewColumnType.Link:t=new Anchor,i.__A=t,i.AddElement(t);break;case GridViewColumnType.Image:t=new ImageElement,i.__I=t,i.AddElement(t)}e.Add(i)}this.Cells.AddRange(e),this.Cells.EndUpdate()},GridViewColumnType={Select:"select",Text:"text",Image:"image",Link:"link",PopUp:"popup",Function:"function",Custom:"custom"};
//@ sourceMappingURL=NinJaGridView.min.js.map